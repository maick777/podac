import{r as s,u as le,c as E,o as D,a as o,b as M,w as r,Q as C,n as oe,t as q,F as j,e as se,f as te,g as ne,h as re,i as F,j as V,k as m,l as ie,m as ue,p as de,q as ce,s as me}from"./index-DhVY4AOr.js";import{u as fe,a as k,Q as pe,b as ve}from"./notifyHooks-DTCs8dSN.js";import{Q as ge}from"./QForm-mmGRrtT6.js";import{Q as _e}from"./QPage-C9SVU1xd.js";import{h as I,_ as be,P as ye}from"./PopupComponent-BMoTzUKP.js";import{_ as he,a as L}from"./selectComponent-DZrnU1wb.js";import{_ as Ve}from"./textareaComponent-BbQtPJaR.js";import{u as we,_ as O,f as Y,a as R}from"./formatDate-DzzFVTZi.js";import{_ as J}from"./imageComponent-G_iIqQmX.js";import{Q as xe,a as Ue}from"./QUploader-CeydzPH5.js";import{u as ke}from"./vue-i18n.runtime-mEmbPDrt.js";import"./use-quasar-2VkCt5Th.js";import"./use-render-cache-7gfEi9oV.js";const Ce={key:0,class:"error"},De={__name:"uploadComponent",props:{label:{type:String,default:""},color:{type:String,default:"red"},api:{type:String,default:""}},emits:["data_pdf"],setup(N,{emit:t}){const v="https://api.ourspace.ggrosio.com"+N.api,S=s(null),u=t,g=f=>{try{const n=JSON.parse(f.xhr.responseText);u("data_pdf",{data:n})}catch(n){console.log(n),u("data_pdf",{error:"Error al procesar la respuesta:"})}},d=f=>{try{const n=JSON.parse(f.xhr.response);u("data_pdf",{error:n.message})}catch(n){console.log(n),u("data_pdf",{error:"Error al procesar la respuesta:"})}},_=le();function w(){return[{name:"Authorization",value:`Bearer ${_.token}`}]}return(f,n)=>(D(),E(j,null,[o(Ue,{label:N.label,glossy:"",url:v,"field-name":"file","auto-upload":"","max-files":"1",headers:w,onUploaded:g,onFailed:d,factory:f.factoryFn,color:"grey-9","text-color":"white",flat:"",bordered:"","add-icon":"cloud_upload"},{header:r(()=>[o(xe),o(C,{icon:"las la-cloud-upload-alt",label:"Selecionar",class:oe(["full-width no-border-radius",f.$q.dark.isActive?"bg-grey-9 text-grey-2":"bg-grey-4 text-grey-9"]),flat:""},null,8,["class"])]),_:1},8,["label","factory"]),S.value?(D(),E("div",Ce,q(S.value),1)):M("",!0)],64))}},Qe=["onClick"],Se={class:"row q-col-gutter-x-xl"},$e={class:"row full-width items-center"},Ye={class:"col-auto"},Ne={class:"col text-right"},Je={__name:"AnuncioPage",setup(N){const{t}=ke(),{successNotify:Q,errorNotify:i}=fe(),v=s(!1),S=k("anuncios"),u=s("anuncios"),g=s("insert"),d=s(!1),_=s(null),w=s("las la-plus-circle"),{showConfirmDelete:f}=we(),n=s(""),p=s(I().format("DD/MM/YYYY")),c=s(null),x=s(null),b=s(1),U=s(""),y=s(""),P=s(""),A={},B=s([]),H=se(()=>[{label:"",name:"imagen",slot:"image",align:"center",sortable:!1,hidden:!0},{label:t("table.title"),name:"name",link:"id",width:"10"},{label:t("table.start"),name:"fecha_inicio",align:"center"},{label:t("table.end"),name:"fecha_fin",align:"center",width:"10"},{label:t("table.status"),name:"estado"}]),h=async()=>{try{v.value=!0,P.value!=""&&(A.search=P.value);const l=await S.list(A);B.value=l.data.map(e=>({...e,fecha_inicio:Y(e.fecha_inicio),fecha_fin:Y(e.fecha_fin)}))}catch(l){console.log("Error...",l),i(l.message)}finally{v.value=!1}},G=l=>{A.search=l.search.trim()??"",h()},K=s({button_add:!0,button_edit:!0,button_delete:!1,button_detail:!0,hidden_pagination:!1,button_pagination_custom:!0}),W=async()=>{z(),g.value="insert",w.value="las la-plus-circle",d.value=!0},X=async l=>{try{if(!l)return i("No existe el identificador"),!1;const a=(await k(u.value).getById(l)).data;n.value=a.name,p.value=Y(a.fecha_inicio),c.value=Y(a.fecha_fin),b.value=a.id_estado,U.value=a.descripcion,y.value=a.imagen,d.value=!0,g.value="update",w.value="las la-edit",_.value=l}catch(e){console.log("Error...",e),h(),i(e.message)}},Z=async()=>{try{f(async()=>{await k(u.value).remove(_.value),h(),d.value=!1})}catch(l){i(l.toString())}},ee=async()=>{const l={name:n.value,fecha_inicio:R(p.value),fecha_fin:R(c.value),id_estado:b.value,id_periodo:b.value,descripcion:U.value,imagen:y.value};if(g.value=="update"){_.value||i("No existe el identificador");try{const e=await k(`${u.value}/${_.value}`).update(l);Q(e.message),d.value=!1,h()}catch(e){e.details?e.details.forEach(a=>{i(a)}):i(e.message)}}else if(g.value=="insert")try{const e=await k(u.value).post(l);Q(e.message),d.value=!1,z(),h()}catch(e){e.details?e.details.forEach(a=>{i(a)}):i(e.message)}else i("Ninguna acción seleccionada!")},z=async()=>{n.value="",x.value=null,p.value=I().format("DD/MM/YYYY"),c.value=null,b.value=null,U.value="",y.value=""},$=s(!1),ae=async l=>{if(l.error)console.log("Error...",l.error),i(l.error);else{const e=l.data;console.log("Logs.........................",e),y.value=e.data,console.log("Success...",l.error),Q("Archivo subido"),setTimeout(()=>{$.value=!1},800)}};return te(x,l=>{if(l&&p.value){const e=I(p.value,"DD/MM/YYYY");e.isValid()?x.value==1?c.value="":c.value=e.add(l,"days").format("DD/MM/YYYY"):c.value=""}else c.value=""}),ne(async()=>{await h(),await re()}),(l,e)=>(D(),E(j,null,[v.value?M("",!0):(D(),F(_e,{key:0,class:"q-pa-md"},{default:r(()=>[o(be,{title:"",columns:H.value,rows:B.value,default_action:K.value,onSearch:G},{header:r(()=>[o(C,{label:m(t)("button.add"),icon:"las la-plus-circle",color:"green",dense:"",outline:"",onClick:e[0]||(e[0]=a=>W())},null,8,["label"])]),id:r(({row:a})=>[V("a",{onClick:T=>X(a.id),class:"link_animate cursor-pointer"},q(a.name),9,Qe)]),image:r(({row:a})=>[o(J,{modelValue:a.imagen,"onUpdate:modelValue":T=>a.imagen=T,size:"20px"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["columns","rows","default_action"]),d.value?(D(),F(ye,{key:0,title:"Anuncio",icon:w.value,onClose:e[11]||(e[11]=a=>d.value=!1),size:"md"},{default:r(()=>[o(ge,{onSubmit:ee},{default:r(()=>[o(ie,{class:"q-pb-sm"},{default:r(()=>[o(ue,null,{default:r(()=>[V("div",Se,[o(he,{label:m(t)("form.title"),modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value=a),rules:"max:100|required"},null,8,["label","modelValue"]),o(J,{label:"Imagen",modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),field:"imagen",class:"col-md-6 col-lg-6"},{default:r(()=>[o(C,{icon:"las la-ellipsis-v",size:"sm",round:"",color:"primary",flat:"",dense:"",onClick:e[2]||(e[2]=a=>$.value=!0),class:"q-mr-xs"})]),_:1},8,["modelValue"]),o(de,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=a=>$.value=a)},{default:r(()=>[o(De,{onData_pdf:ae,api:"/uploads/image",label:"Seleccione una imagen",color:"green"})]),_:1},8,["modelValue"]),o(O,{label:m(t)("form.start"),modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a),rules:"required",class:""},null,8,["label","modelValue"]),o(L,{label:m(t)("form.show_by"),modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=a=>x.value=a),rules:"",class:"",dataenum:"7|1 semana;14|2 semanas;30|1 mes;30|2 meses;60|3 meses;120|6 meses;365|1 año;1|Indefinido;"},null,8,["label","modelValue"]),o(O,{label:m(t)("form.end"),modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value=a),rules:"",class:""},null,8,["label","modelValue"]),o(L,{label:m(t)("form.status"),modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=a=>b.value=a),rules:"integer",class:"",api:"estados_activacion"},null,8,["label","modelValue"]),o(Ve,{label:m(t)("form.description"),modelValue:U.value,"onUpdate:modelValue":e[9]||(e[9]=a=>U.value=a),rules:"max:600",class:"col-md-12 col-lg-12"},null,8,["label","modelValue"])])]),_:1}),o(ce,{class:"q-pt-md"},{default:r(()=>[V("div",$e,[e[12]||(e[12]=V("div",{class:"col"},null,-1)),V("div",Ye,[o(C,{label:m(t)("button.save"),type:"submit",color:"positive",icon:"las la-save",dense:"",outline:""},null,8,["label"])]),V("div",Ne,[o(C,{label:"",color:"negative",icon:"las la-trash-alt",dense:"",flat:"",onClick:e[10]||(e[10]=a=>Z())},{default:r(()=>[o(pe,{class:"bg-red",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:r(()=>[me(q(m(t)("button.delete")),1)]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1})]),_:1},8,["icon"])):M("",!0)]),_:1})),o(ve,{showing:v.value,label:"Cargando...","label-class":"text-teal",color:"blue","label-style":"font-size: 1.1em"},null,8,["showing"])],64))}};export{Je as default};
