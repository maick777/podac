import{a2 as Y,al as _e,am as re,bl as se,b4 as he,a4 as K,b5 as be,e as h,bm as Fe,a7 as s,b6 as ye,r as z,be as de,aa as ce,aC as Se,a3 as qe,a5 as xe,bn as oe,f as ke,ah as ze,bo as we,ab as Ue,bh as Ce,a9 as ue,aT as Be,Z as Re,Q as ne,ap as Pe,av as Ee}from"./index-DhVY4AOr.js";const Je=Y({name:"QUploaderAddTrigger",setup(){const a=_e(se,re);return a===re&&console.error("QUploaderAddTrigger needs to be child of QUploader"),a}}),je={...he,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:a=>a>=0&&a<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},G=50,ve=2*G,fe=ve*Math.PI,Le=Math.round(fe*1e3)/1e3,Ne=Y({name:"QCircularProgress",props:{...je,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(a,{slots:f}){const{proxy:{$q:o}}=K(),r=be(a),u=h(()=>{const g=(o.lang.rtl===!0?-1:1)*a.angle;return{transform:a.reverse!==(o.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-g}deg)`:`rotate3d(0, 0, 1, ${g-90}deg)`}}),m=h(()=>a.instantFeedback!==!0&&a.indeterminate!==!0?{transition:`stroke-dashoffset ${a.animationSpeed}ms ease 0s, stroke ${a.animationSpeed}ms ease`}:""),F=h(()=>ve/(1-a.thickness/2)),w=h(()=>`${F.value/2} ${F.value/2} ${F.value} ${F.value}`),U=h(()=>Fe(a.value,a.min,a.max)),R=h(()=>a.max-a.min),q=h(()=>a.thickness/2*F.value),E=h(()=>{const g=(a.max-U.value)/R.value,e=a.rounded===!0&&U.value<a.max&&g<.25?q.value/2*(1-g/.25):0;return fe*g+e});function C({thickness:g,offset:e,color:p,cls:x,rounded:d}){return s("circle",{class:"q-circular-progress__"+x+(p!==void 0?` text-${p}`:""),style:m.value,fill:"transparent",stroke:"currentColor","stroke-width":g,"stroke-dasharray":Le,"stroke-dashoffset":e,"stroke-linecap":d,cx:F.value,cy:F.value,r:G})}return()=>{const g=[];a.centerColor!==void 0&&a.centerColor!=="transparent"&&g.push(s("circle",{class:`q-circular-progress__center text-${a.centerColor}`,fill:"currentColor",r:G-q.value/2,cx:F.value,cy:F.value})),a.trackColor!==void 0&&a.trackColor!=="transparent"&&g.push(C({cls:"track",thickness:q.value,offset:0,color:a.trackColor})),g.push(C({cls:"circle",thickness:q.value,offset:E.value,color:a.color,rounded:a.rounded===!0?"round":void 0}));const e=[s("svg",{class:"q-circular-progress__svg",style:u.value,viewBox:w.value,"aria-hidden":"true"},g)];return a.showValue===!0&&e.push(s("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:a.fontSize}},f.default!==void 0?f.default():[s("div",U.value)])),s("div",{class:`q-circular-progress q-circular-progress--${a.indeterminate===!0?"in":""}determinate`,style:r.value,role:"progressbar","aria-valuemin":a.min,"aria-valuemax":a.max,"aria-valuenow":a.indeterminate===!0?void 0:U.value},ye(f.internal,e))}}});function Q(a,f,o,r){const u=[];return a.forEach(m=>{r(m)===!0?u.push(m):f.push({failedPropValidation:o,file:m})}),u}function H(a){a?.dataTransfer&&(a.dataTransfer.dropEffect="copy"),ce(a)}const Te={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ae=["rejected"];function $e({editable:a,dnd:f,getFileInput:o,addFilesToQueue:r}){const{props:u,emit:m,proxy:F}=K(),w=z(null),U=h(()=>u.accept!==void 0?u.accept.split(",").map(l=>(l=l.trim(),l==="*"?"*/":(l.endsWith("/*")&&(l=l.slice(0,l.length-1)),l.toUpperCase()))):null),R=h(()=>parseInt(u.maxFiles,10)),q=h(()=>parseInt(u.maxTotalSize,10));function E(l){if(a.value)if(l!==Object(l)&&(l={target:null}),l.target?.matches('input[type="file"]')===!0)l.clientX===0&&l.clientY===0&&de(l);else{const k=o();k!==l.target&&k?.click(l)}}function C(l){a.value&&l&&r(null,l)}function g(l,k,T,A){let i=Array.from(k||l.target.files);const _=[],B=()=>{_.length!==0&&m("rejected",_)};if(u.accept!==void 0&&U.value.indexOf("*/")===-1&&(i=Q(i,_,"accept",c=>U.value.some(b=>c.type.toUpperCase().startsWith(b)||c.name.toUpperCase().endsWith(b))),i.length===0))return B();if(u.maxFileSize!==void 0){const c=parseInt(u.maxFileSize,10);if(i=Q(i,_,"max-file-size",b=>b.size<=c),i.length===0)return B()}if(u.multiple!==!0&&i.length!==0&&(i=[i[0]]),i.forEach(c=>{c.__key=c.webkitRelativePath+c.lastModified+c.name+c.size}),A===!0){const c=T.map(b=>b.__key);i=Q(i,_,"duplicate",b=>c.includes(b.__key)===!1)}if(i.length===0)return B();if(u.maxTotalSize!==void 0){let c=A===!0?T.reduce((b,j)=>b+j.size,0):0;if(i=Q(i,_,"max-total-size",b=>(c+=b.size,c<=q.value)),i.length===0)return B()}if(typeof u.filter=="function"){const c=u.filter(i);i=Q(i,_,"filter",b=>c.includes(b))}if(u.maxFiles!==void 0){let c=A===!0?T.length:0;if(i=Q(i,_,"max-files",()=>(c++,c<=R.value)),i.length===0)return B()}if(B(),i.length!==0)return i}function e(l){H(l),f.value!==!0&&(f.value=!0)}function p(l){ce(l),(l.relatedTarget!==null||Se.is.safari!==!0?l.relatedTarget!==w.value:document.elementsFromPoint(l.clientX,l.clientY).includes(w.value)===!1)===!0&&(f.value=!1)}function x(l){H(l);const k=l.dataTransfer.files;k.length!==0&&r(null,k),f.value=!1}function d(l){if(f.value===!0)return s("div",{ref:w,class:`q-${l}__dnd absolute-full`,onDragenter:H,onDragover:H,onDragleave:p,onDrop:x})}return Object.assign(F,{pickFiles:E,addFiles:C}),{pickFiles:E,addFiles:C,onDragover:e,onDragleave:p,processFiles:g,getDndNode:d,maxFilesNumber:R,maxTotalSizeNumber:q}}function ie(a){return(a*100).toFixed(2)+"%"}const Oe={...qe,...Te,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},pe=[...Ae,"start","finish","added","removed"];function De(a,f){const o=K(),{props:r,slots:u,emit:m,proxy:F}=o,{$q:w}=F,U=xe(r,w);function R(t,v,y){if(t.__status=v,v==="idle"){t.__uploaded=0,t.__progress=0,t.__sizeLabel=oe(t.size),t.__progressLabel="0.00%";return}if(v==="failed"){F.$forceUpdate();return}t.__uploaded=v==="uploaded"?t.size:y,t.__progress=v==="uploaded"?1:Math.min(.9999,t.__uploaded/t.size),t.__progressLabel=ie(t.__progress),F.$forceUpdate()}const q=h(()=>r.disable!==!0&&r.readonly!==!0),E=z(!1),C=z(null),g=z(null),e={files:z([]),queuedFiles:z([]),uploadedFiles:z([]),uploadedSize:z(0),updateFileStatus:R,isAlive:()=>Be(o)===!1},{pickFiles:p,addFiles:x,onDragover:d,onDragleave:l,processFiles:k,getDndNode:T,maxFilesNumber:A,maxTotalSizeNumber:i}=$e({editable:q,dnd:E,getFileInput:V,addFilesToQueue:ee});Object.assign(e,a({props:r,slots:u,emit:m,helpers:e,exposeApi:t=>{Object.assign(e,t)}})),e.isBusy===void 0&&(e.isBusy=z(!1));const _=z(0),B=h(()=>_.value===0?0:e.uploadedSize.value/_.value),c=h(()=>ie(B.value)),b=h(()=>oe(_.value)),j=h(()=>q.value===!0&&e.isUploading.value!==!0&&(r.multiple===!0||e.queuedFiles.value.length===0)&&(r.maxFiles===void 0||e.files.value.length<A.value)&&(r.maxTotalSize===void 0||_.value<i.value)),n=h(()=>q.value===!0&&e.isBusy.value!==!0&&e.isUploading.value!==!0&&e.queuedFiles.value.length!==0);Pe(se,te);const $=h(()=>"q-uploader column no-wrap"+(U.value===!0?" q-uploader--dark q-dark":"")+(r.bordered===!0?" q-uploader--bordered":"")+(r.square===!0?" q-uploader--square no-border-radius":"")+(r.flat===!0?" q-uploader--flat no-shadow":"")+(r.disable===!0?" disabled q-uploader--disable":"")+(E.value===!0?" q-uploader--dnd":"")),O=h(()=>"q-uploader__header"+(r.color!==void 0?` bg-${r.color}`:"")+(r.textColor!==void 0?` text-${r.textColor}`:""));ke(e.isUploading,(t,v)=>{v===!1&&t===!0?m("start"):v===!0&&t===!1&&m("finish")});function D(){r.disable===!1&&(e.abort(),e.uploadedSize.value=0,_.value=0,J(),e.files.value=[],e.queuedFiles.value=[],e.uploadedFiles.value=[])}function P(){r.disable===!1&&Z(["uploaded"],()=>{e.uploadedFiles.value=[]})}function W(){Z(["idle","failed"],({size:t})=>{_.value-=t,e.queuedFiles.value=[]})}function Z(t,v){if(r.disable===!0)return;const y={files:[],size:0},L=e.files.value.filter(S=>t.indexOf(S.__status)===-1?!0:(y.size+=S.size,y.files.push(S),S.__img!==void 0&&window.URL.revokeObjectURL(S.__img.src),!1));y.files.length!==0&&(e.files.value=L,v(y),m("removed",y.files))}function X(t){r.disable||(t.__status==="uploaded"?e.uploadedFiles.value=e.uploadedFiles.value.filter(v=>v.__key!==t.__key):t.__status==="uploading"?t.__abort():_.value-=t.size,e.files.value=e.files.value.filter(v=>v.__key!==t.__key?!0:(v.__img!==void 0&&window.URL.revokeObjectURL(v.__img.src),!1)),e.queuedFiles.value=e.queuedFiles.value.filter(v=>v.__key!==t.__key),m("removed",[t]))}function J(){e.files.value.forEach(t=>{t.__img!==void 0&&window.URL.revokeObjectURL(t.__img.src)})}function V(){return g.value||C.value.getElementsByClassName("q-uploader__input")[0]}function ee(t,v){const y=k(t,v,e.files.value,!0),L=V();L!=null&&(L.value=""),y!==void 0&&(y.forEach(S=>{if(e.updateFileStatus(S,"idle"),_.value+=S.size,r.noThumbnails!==!0&&S.type.toUpperCase().startsWith("IMAGE")){const le=new Image;le.src=window.URL.createObjectURL(S),S.__img=le}}),e.files.value=e.files.value.concat(y),e.queuedFiles.value=e.queuedFiles.value.concat(y),m("added",y),r.autoUpload===!0&&e.upload())}function ae(){n.value===!0&&e.upload()}function M(t,v,y){if(t===!0){const L={type:"a",key:v,icon:w.iconSet.uploader[v],flat:!0,dense:!0};let S;return v==="add"?(L.onClick=p,S=te):L.onClick=y,s(ne,L,S)}}function te(){return s("input",{ref:g,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:r.accept,multiple:r.multiple===!0?"multiple":void 0,capture:r.capture,onMousedown:de,onClick:p,onChange:ee})}function me(){return u.header!==void 0?u.header(I):[s("div",{class:"q-uploader__header-content column"},[s("div",{class:"flex flex-center no-wrap q-gutter-xs"},[M(e.queuedFiles.value.length!==0,"removeQueue",W),M(e.uploadedFiles.value.length!==0,"removeUploaded",P),e.isUploading.value===!0?s(ue,{class:"q-uploader__spinner"}):null,s("div",{class:"col column justify-center"},[r.label!==void 0?s("div",{class:"q-uploader__title"},[r.label]):null,s("div",{class:"q-uploader__subtitle"},[b.value+" / "+c.value])]),M(j.value,"add"),M(r.hideUploadBtn===!1&&n.value===!0,"upload",e.upload),M(e.isUploading.value,"clear",e.abort)])])]}function ge(){return u.list!==void 0?u.list(I):e.files.value.map(t=>s("div",{key:t.__key,class:"q-uploader__file relative-position"+(r.noThumbnails!==!0&&t.__img!==void 0?" q-uploader__file--img":"")+(t.__status==="failed"?" q-uploader__file--failed":t.__status==="uploaded"?" q-uploader__file--uploaded":""),style:r.noThumbnails!==!0&&t.__img!==void 0?{backgroundImage:'url("'+t.__img.src+'")',backgroundSize:r.thumbnailFit}:null},[s("div",{class:"q-uploader__file-header row flex-center no-wrap"},[t.__status==="failed"?s(Re,{class:"q-uploader__file-status",name:w.iconSet.type.negative,color:"negative"}):null,s("div",{class:"q-uploader__file-header-content col"},[s("div",{class:"q-uploader__title"},[t.name]),s("div",{class:"q-uploader__subtitle row items-center no-wrap"},[t.__sizeLabel+" / "+t.__progressLabel])]),t.__status==="uploading"?s(Ne,{value:t.__progress,min:0,max:1,indeterminate:t.__progress===0}):s(ne,{round:!0,dense:!0,flat:!0,icon:w.iconSet.uploader[t.__status==="uploaded"?"done":"clear"],onClick:()=>{X(t)}})])]))}ze(()=>{e.isUploading.value===!0&&e.abort(),e.files.value.length!==0&&J()});const I={};for(const t in e)we(e[t])===!0?Ue(I,t,()=>e[t].value):I[t]=e[t];return Object.assign(I,{upload:ae,reset:D,removeUploadedFiles:P,removeQueuedFiles:W,removeFile:X,pickFiles:p,addFiles:x}),Ce(I,{canAddFiles:()=>j.value,canUpload:()=>n.value,uploadSizeLabel:()=>b.value,uploadProgressLabel:()=>c.value}),f({...e,upload:ae,reset:D,removeUploadedFiles:P,removeQueuedFiles:W,removeFile:X,pickFiles:p,addFiles:x,canAddFiles:j,canUpload:n,uploadSizeLabel:b,uploadProgressLabel:c}),()=>{const t=[s("div",{class:O.value},me()),s("div",{class:"q-uploader__list scroll"},ge()),T("uploader")];e.isBusy.value===!0&&t.push(s("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[s(ue)]));const v={ref:C,class:$.value};return j.value===!0&&Object.assign(v,{onDragover:d,onDragleave:l}),s("div",v,t)}}const Ie=()=>!0;function Qe(a){const f={};return a.forEach(o=>{f[o]=Ie}),f}const Me=Qe(pe),We=({name:a,props:f,emits:o,injectPlugin:r})=>Y({name:a,props:{...Oe,...f},emits:Ee(o)===!0?{...Me,...o}:[...pe,...o],setup(u,{expose:m}){return De(r,m)}});function N(a){return typeof a=="function"?a:()=>a}const He="QUploader",Xe={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>a=>a.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},Ge=["factoryFailed","uploaded","failed","uploading"];function Ye({props:a,emit:f,helpers:o}){const r=z([]),u=z([]),m=z(0),F=h(()=>({url:N(a.url),method:N(a.method),headers:N(a.headers),formFields:N(a.formFields),fieldName:N(a.fieldName),withCredentials:N(a.withCredentials),sendRaw:N(a.sendRaw),batch:N(a.batch)})),w=h(()=>m.value>0),U=h(()=>u.value.length!==0);let R;function q(){r.value.forEach(e=>{e.abort()}),u.value.length!==0&&(R=!0)}function E(){const e=o.queuedFiles.value.slice(0);o.queuedFiles.value=[],F.value.batch(e)?C(e):e.forEach(p=>{C([p])})}function C(e){if(m.value++,typeof a.factory!="function"){g(e,{});return}const p=a.factory(e);if(!p)f("factoryFailed",new Error("QUploader: factory() does not return properly"),e),m.value--;else if(typeof p.catch=="function"&&typeof p.then=="function"){u.value.push(p);const x=d=>{o.isAlive()===!0&&(u.value=u.value.filter(l=>l!==p),u.value.length===0&&(R=!1),o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(l=>{o.updateFileStatus(l,"failed")}),f("factoryFailed",d,e),m.value--)};p.then(d=>{R===!0?x(new Error("Aborted")):o.isAlive()===!0&&(u.value=u.value.filter(l=>l!==p),g(e,d))}).catch(x)}else g(e,p||{})}function g(e,p){const x=new FormData,d=new XMLHttpRequest,l=(n,$)=>p[n]!==void 0?N(p[n])($):F.value[n]($),k=l("url",e);if(!k){console.error("q-uploader: invalid or no URL specified"),m.value--;return}const T=l("formFields",e);T!==void 0&&T.forEach(n=>{x.append(n.name,n.value)});let A=0,i=0,_=0,B=0,c;d.upload.addEventListener("progress",n=>{if(c===!0)return;const $=Math.min(B,n.loaded);o.uploadedSize.value+=$-_,_=$;let O=_-i;for(let D=A;O>0&&D<e.length;D++){const P=e[D];if(O>P.size)O-=P.size,A++,i+=P.size,o.updateFileStatus(P,"uploading",P.size);else{o.updateFileStatus(P,"uploading",O);return}}},!1),d.onreadystatechange=()=>{d.readyState<4||(d.status&&d.status<400?(o.uploadedFiles.value=o.uploadedFiles.value.concat(e),e.forEach(n=>{o.updateFileStatus(n,"uploaded")}),f("uploaded",{files:e,xhr:d})):(c=!0,o.uploadedSize.value-=_,o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(n=>{o.updateFileStatus(n,"failed")}),f("failed",{files:e,xhr:d})),m.value--,r.value=r.value.filter(n=>n!==d))},d.open(l("method",e),k),l("withCredentials",e)===!0&&(d.withCredentials=!0);const b=l("headers",e);b!==void 0&&b.forEach(n=>{d.setRequestHeader(n.name,n.value)});const j=l("sendRaw",e);e.forEach(n=>{o.updateFileStatus(n,"uploading",0),j!==!0&&x.append(l("fieldName",n),n,n.name),n.xhr=d,n.__abort=()=>{d.abort()},B+=n.size}),f("uploading",{files:e,xhr:d}),r.value.push(d),j===!0?d.send(new Blob(e)):d.send(x)}return{isUploading:w,isBusy:U,abort:q,upload:E}}const Ke={name:He,props:Xe,emits:Ge,injectPlugin:Ye},Ve=We(Ke);export{Je as Q,Ve as a};
