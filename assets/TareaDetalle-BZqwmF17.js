import{u as _e,a as p,c as be,d as ge,e as ye,f as he,C as Ve,Q as m,b as ke}from"./notifyHooks-DTCs8dSN.js";import{r as i,e as J,f as W,g as we,c as Ce,o as g,a as l,w as t,m as X,i as k,b as P,y as xe,s as c,Z as Y,t as r,k as n,Q as w,n as Qe,j as C,ac as j,l as ee,q as $e,F as Ue}from"./index-DhVY4AOr.js";import{Q as qe}from"./QBtnDropdown-fPiSFeZG.js";import{Q as ze}from"./QForm-mmGRrtT6.js";import{_ as Ne,P as De}from"./PopupComponent-BMoTzUKP.js";import{a as x,_ as Se}from"./selectComponent-DZrnU1wb.js";import{_ as Ie}from"./textareaComponent-BbQtPJaR.js";import{u as Be,_ as G,f as y,a as ae}from"./formatDate-DzzFVTZi.js";import{_ as Ae}from"./imageComponent-G_iIqQmX.js";import{u as Ee}from"./vue-i18n.runtime-mEmbPDrt.js";import"./use-quasar-2VkCt5Th.js";import"./use-render-cache-7gfEi9oV.js";const Pe={class:"q-gutter-none q-mx-md"},Fe=["onClick"],Le={class:"row full-width items-center"},Re={class:"col-auto"},Te={class:"col text-right"},aa={__name:"TareaDetalle",props:{parent:{type:Number,required:!1,default:null}},setup(le){const{showConfirmDelete:te}=Be(),{successNotify:E,errorNotify:u}=_e(),{t:s}=Ee(),oe=p("tarea_detalles"),h=i("tarea_detalles"),_=i(!1),F=i("insert"),b=i(!1),Q=i(null),K=i("las la-plus-circle"),L=le,$=i(null),U=i(null),q=i(null),z=i(""),N=i(""),D=i(null),V=i(null),S=i(null),R=i(null),T=i(null),f=i(null),I=i(null),B=i(""),v={},M=i([]),se=J(()=>[{label:"",name:"prioridad",slot:"semaforo",hidden:!0,align:"center",width:"10"},{label:s("table.title"),name:"name",link:"id",slot:"acciones"},{label:s("table.responsible"),name:"usuario",slot:"responsable",hidden:!0},{label:s("table.entity"),name:"categoria"},{label:s("table.start"),name:"fecha_inicio",align:"center"},{label:s("table.status"),name:"estado",align:"center"},{label:s("table.limit"),name:"fecha_limite",align:"center"},{label:s("table.end"),name:"fecha_fin",align:"center"}]),O=i(0),d=async()=>{try{_.value=!0,B.value!=""&&(v.search=B.value),v.id_tarea=L.parent||0;const o=await oe.list(v);M.value=o.data.map(e=>({...e,fecha_inicio:y(e.fecha_inicio),fecha_limite:y(e.fecha_limite),fecha_fin:y(e.fecha_fin)}))}catch(o){console.log("Error...",o),u(o.message)}finally{_.value=!1}},ie=async o=>{v.search=o.search.trim()??"",await d()};W(f,o=>{v.id_prioridad=o||null,d()}),W(I,o=>{v.id_estado=o||null,d()});const ne=async()=>{f.value=null,I.value=null,B.value="",v.search="",v.id_prioridad=null,v.id_estado=null,O.value++,await d()},ue=J(()=>!!f.value||!!I.value||B.value&&B.value.trim()!==""),re=i({button_action_style:"dropdown",button_add:!0,button_edit:!0,button_delete:!1,button_detail:!0,hidden_pagination:!1,button_reset:!1,button_cancel:!1,button_pagination_custom:!0}),de=async()=>{try{const o={id_tarea:L.parent},e=await p(h.value).post(o);E(e.message),b.value=!1,H(),await d()}catch(o){u(o.message)}},ce=async o=>{try{if(!o)return u("No existe el identificador"),!1;const e=await p(h.value).getById(o),a=e.data;$.value=a.id_usuario,U.value=a.id_categoria,q.value=a.id_prioridad,z.value=a.name,N.value=a.detalle,D.value=y(a.fecha_inicio),V.value=y(a.fecha_limite),V.value=y(a.fecha_limite),S.value=a.id_estado,R.value=y(a.created_at),T.value=a.id_user_create,b.value=!0,K.value="las la-edit",F.value="update",Q.value=o,console.log("Success...",e)}catch(e){console.log("Error...",e),await d(),u(e.message)}},me=async o=>{try{if(!o)return u("No existe el identificador"),!1;te(async()=>{await p(h.value).remove(o),await d(),b.value=!1})}catch(e){u(e.toString())}},Z=async o=>{try{const e={id:o},a=await p(`/copy/${h.value}`).post(e);E(a.message),await d()}catch(e){u(e.message)}},fe=i([]),ve=async()=>{try{const o=await p("/usuarios/cbo").list();fe.value=o.data,console.log(o.data)}catch(o){u(o.message)}},pe=async()=>{const o={id_usuario:$.value,id_categoria:U.value,id_prioridad:q.value,name:z.value,detalle:N.value,fecha_inicio:ae(D.value),fecha_limite:ae(V.value),id_estado:S.value,id_tarea:L.parent};if(F.value=="update"){console.log(Q.value),Q.value||u("No existe el identificador");try{_.value=!0,console.log("data..........................",o);const e=await p(`${h.value}/${Q.value}`).update(o);E(e.message),b.value=!1,await d()}catch(e){e.details?e.details.forEach(a=>{u(a)}):u(e.message)}finally{_.value=!1}}else if(F.value=="insert")try{_.value=!0;const e=await p(h.value).post(o);E(e.message),b.value=!1,H(),await d()}catch(e){e.details?e.details.forEach(a=>{u(a)}):u(e.message)}finally{_.value=!1}else u("Ninguna acciÃ³n seleccionada!")},H=async()=>{$.value=null,U.value=null,q.value=null,z.value="",N.value="",D.value=null,V.value=null,S.value=null};return we(()=>{d(),ve()}),(o,e)=>(g(),Ce(Ue,null,[l(ee,{bordered:"",class:"q-mx-sm rounded-borders"},{default:t(()=>[l(X,null,{default:t(()=>[(g(),k(Ne,{title:"",key:O.value,columns:se.value,rows:M.value,default_action:re.value,onSearch:ie},{header:t(()=>[l(w,{label:"",icon:"las la-plus",color:"green",dense:"",outline:"",onClick:e[0]||(e[0]=a=>de())},{default:t(()=>[l(m,{class:"bg-default",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(n(s)("button.add")),1)]),_:1})]),_:1})]),header_right:t(()=>[ue.value?(g(),k(w,{key:0,icon:"las la-undo-alt",class:"q-mx-sm",flat:"",round:"",size:"sm",onClick:e[1]||(e[1]=a=>ne())},{default:t(()=>[l(m,{class:"bg-default",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(n(s)("button.clear_filter")),1)]),_:1})]),_:1})):P("",!0),l(x,{label:n(s)("form.status"),modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=a=>I.value=a),api:"estados_tarea",rules:"integer"},null,8,["label","modelValue"]),C("div",Pe,[l(j,{"keep-color":"",modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),"checked-icon":"check_circle","unchecked-icon":"circle",val:"2",color:"red",size:"xs",dense:""},{default:t(()=>[l(m,{class:"bg-red",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(n(s)("priority.high")),1)]),_:1})]),_:1},8,["modelValue"]),l(j,{"keep-color":"",modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),"checked-icon":"check_circle","unchecked-icon":"circle",val:"3",color:"yellow",size:"xs",dense:""},{default:t(()=>[l(m,{class:"bg-yellow text-black",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(n(s)("priority.medium")),1)]),_:1})]),_:1},8,["modelValue"]),l(j,{"keep-color":"",modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),"checked-icon":"check_circle","unchecked-icon":"circle",val:"1",color:"green",size:"xs",dense:""},{default:t(()=>[l(m,{class:"bg-green",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(n(s)("priority.low")),1)]),_:1})]),_:1},8,["modelValue"])])]),id:t(({row:a})=>[C("a",{onClick:A=>ce(a.id),class:"link_animate cursor-pointer"},r(a.name),9,Fe)]),semaforo:t(({row:a})=>[a.prioridad?(g(),k(Y,{key:0,name:"circle",color:a.color},{default:t(()=>[l(m,{class:Qe(`bg-${a.color}`),offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(a.prioridad),1)]),_:2},1032,["class"])]),_:2},1032,["color"])):P("",!0)]),responsable:t(({row:a})=>[a.usuario?(g(),k(Ae,{key:0,modelValue:a.usuario_foto,"onUpdate:modelValue":A=>a.usuario_foto=A,size:"20px"},{default:t(()=>[l(m,{class:"bb-default",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(a.usuario),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):P("",!0)]),duplicar:t(({row:a})=>[l(w,{icon:"las la-copy",color:"grey",onClick:A=>Z(a.id),size:"sm",dense:"",flat:""},{default:t(()=>[l(m,{class:"bg-grey",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(n(s)("button.duplicate")),1)]),_:1})]),_:2},1032,["onClick"])]),aceptar:t(({row:a})=>[l(w,{icon:"las la-copy",color:"grey",onClick:A=>o.buttonAcept(a.id),size:"sm",dense:"",flat:""},{default:t(()=>[l(m,{class:"bg-grey",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(n(s)("button.accept")),1)]),_:1})]),_:2},1032,["onClick"])]),acciones:t(({row:a})=>[l(qe,{color:"secondary",size:"sm",round:"",flat:"",dense:"","dropdown-icon":"las la-ellipsis-v","menu-anchor":"top right","menu-self":"top left","auto-close":!0},{default:t(()=>[l(be,{class:"custon_list_before",dense:""},{default:t(()=>[xe((g(),k(ge,{clickable:"",onClick:A=>Z(a.id)},{default:t(()=>[l(ye,null,{default:t(()=>[l(he,null,{default:t(()=>[l(Y,{name:"las la-copy",size:"sm",color:"primary"}),c(" "+r(n(s)("button.duplicate")),1)]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[Ve]])]),_:2},1024)]),_:2},1024)]),_:1},8,["columns","rows","default_action"])),b.value?(g(),k(De,{key:0,title:"Sub tarea",icon:K.value,onClose:e[17]||(e[17]=a=>b.value=!1),size:"lg"},{default:t(()=>[l(ze,{onSubmit:pe},{default:t(()=>[l(ee,null,{default:t(()=>[l(X,{class:"row q-col-gutter-x-lg"},{default:t(()=>[l(x,{label:n(s)("form.user"),modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=a=>$.value=a),rules:"integer|required",api:"usuarios",class:"col-md-6 col-lg-6"},null,8,["label","modelValue"]),l(x,{label:n(s)("form.entity"),modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=a=>U.value=a),rules:"integer|required",api:"tarea_categorias"},null,8,["label","modelValue"]),l(Se,{label:n(s)("form.name"),modelValue:z.value,"onUpdate:modelValue":e[8]||(e[8]=a=>z.value=a),rules:"max:70|required"},null,8,["label","modelValue"]),l(G,{label:n(s)("form.start"),modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=a=>D.value=a),rules:"required",class:"col-md-3 col-lg-3"},null,8,["label","modelValue"]),l(Ie,{label:n(s)("form.detail"),modelValue:N.value,"onUpdate:modelValue":e[10]||(e[10]=a=>N.value=a),rules:"max:700",class:"col-md-6 col-lg-6"},null,8,["label","modelValue"]),l(G,{label:n(s)("form.limit"),modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=a=>V.value=a),rules:"required",class:"col-md-3 col-lg-23"},null,8,["label","modelValue"]),l(x,{label:n(s)("form.priority"),modelValue:q.value,"onUpdate:modelValue":e[12]||(e[12]=a=>q.value=a),rules:"integer|required",api:"estados_prioridad"},null,8,["label","modelValue"]),l(x,{label:n(s)("form.status"),modelValue:S.value,"onUpdate:modelValue":e[13]||(e[13]=a=>S.value=a),rules:"integer",api:"estados_tarea"},null,8,["label","modelValue"]),l(G,{label:n(s)("form.created_date"),modelValue:R.value,"onUpdate:modelValue":e[14]||(e[14]=a=>R.value=a),rules:"disabled",class:"col-md-3 col-lg-23"},null,8,["label","modelValue"]),l(x,{label:n(s)("form.created_user"),modelValue:T.value,"onUpdate:modelValue":e[15]||(e[15]=a=>T.value=a),rules:"integer|disabled",api:"usuarios"},null,8,["label","modelValue"])]),_:1}),l($e,{class:"q-pt-md"},{default:t(()=>[C("div",Le,[e[18]||(e[18]=C("div",{class:"col"},null,-1)),C("div",Re,[l(w,{label:"Guardar",type:"submit",color:"positive",icon:"las la-save",dense:"",outline:""})]),C("div",Te,[l(w,{label:"",color:"negative",icon:"las la-trash-alt",dense:"",flat:"",onClick:e[16]||(e[16]=a=>me(Q.value))},{default:t(()=>[l(m,{class:"bg-red",offset:[10,10],"transition-show":"scale","transition-hide":"scale"},{default:t(()=>[c(r(n(s)("button.delete")),1)]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1})]),_:1},8,["icon"])):P("",!0)]),_:1})]),_:1}),l(ke,{showing:_.value,label:n(s)("loading"),"label-class":"text-teal",color:"blue","label-style":"font-size: 1.1em"},null,8,["showing","label"])],64))}};export{aa as default};
